<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="tekvideo-dash-simple-summary.html">

<dom-module id="tekvideo-dash-filter">

<template>
<style include="iron-flex"></style>
<style is="custom-style">
:host {
    display: block;
    width: 100%;
    height: 100%;
}

#resultsContainer > * {
    margin-bottom: 20px;
}
</style>

<paper-input label="Søg" value="{{search}}">
    <iron-icon icon="search" prefix></iron-icon>
</paper-input>

<p>Viser <b>{{_resultCount}}</b> resultat(er)</p>

<div id="resultsContainer">
    <tekvideo-dash-simple-summary
        heading="Antal visninger"
        content="Viser en graf over visninger af dette emne over tid"
        link="#/viewGraph">
    </tekvideo-dash-simple-summary>
    <tekvideo-dash-simple-summary
        heading="Populære emner"
        content="Viser en liste over populære emner"
        link="#/viewsPopular">
    </tekvideo-dash-simple-summary>
    <tekvideo-dash-simple-summary
        heading="Rå svar data"
        content="Viser rå svar data fra en video"
        link="#/answers">
    </tekvideo-dash-simple-summary>
    <tekvideo-dash-simple-summary
        heading="Bruger deltagelse"
        content="Viser bruger deltagelse"
        link="#/studentParticipation">
    </tekvideo-dash-simple-summary>
</div>

</template>

<script>
Polymer({
    is: 'tekvideo-dash-filter',
    properties: {
        _resultCount: {
            type: Number
        }
    },

    observers: [
        "_onSearchChange(search)"
    ],

    _onSearchChange: function(search) {
        var self = this;
        var children = self.$.resultsContainer.children;
        var count = 0;
        for (var i = 0; i < children.length; i++) {
            var child = children[i];
            child.hidden = self._shouldHide(search, child);
            if (!child.hidden) {
                count++;
            }
        }
        this._resultCount = count;
    },

    _shouldHide: function(search, child) {
        if (search.length === 0) {
            return false;
        } else {
            var query = search.toLowerCase()
            if (child.heading.toLowerCase().indexOf(query) !== -1) {
                return false;
            } else if (child.content.toLowerCase().indexOf(query) !== -1) {
                return false;
            } else {
                return true;
            }
        }
    },

    attached: function() {
        var self = this;
    }
});
</script>
</dom-module>